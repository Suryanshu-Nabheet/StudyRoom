(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[786],{471:function(){},1632:function(){},9582:function(e,t,s){Promise.resolve().then(s.bind(s,9092))},9092:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var r=s(7821),n=s(8078),o=s(8504);function a(e){let{peers:t,localStream:s,previewStream:o,mySocketId:a,participants:i,userName:l}=e,c=(0,n.useRef)(new Map),d=(0,n.useRef)(null),[m,u]=(0,n.useState)(!0),[g,x]=(0,n.useState)(!1),p=o||s;(0,n.useEffect)(()=>{let e=()=>{x(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,n.useEffect)(()=>{d.current&&p?d.current.srcObject!==p&&(d.current.srcObject=p,u(!1)):p||u(!0),t.forEach((e,t)=>{let s=c.current.get(t);s&&e.stream&&e.stream!==p&&s.srcObject!==e.stream&&(s.srcObject=e.stream)});let e=new Set(t.keys());c.current.forEach((t,s)=>{e.has(s)||(t.srcObject&&(t.srcObject.getTracks().forEach(e=>e.stop()),t.srcObject=null),c.current.delete(s))})},[t,p]);let h=Array.from(t.entries()).filter(e=>{let[,t]=e;return t.stream&&t.stream!==p}).length+(p?1:0),{cols:f,rows:b}=function(e,t){if(0===e||1===e)return{cols:1,rows:1};if(t)return 2===e?{cols:2,rows:1}:e<=4?{cols:2,rows:2}:e<=6?{cols:2,rows:3}:{cols:2,rows:Math.ceil(e/2)};if(2===e)return{cols:2,rows:1};if(e<=4)return{cols:2,rows:2};if(e<=6)return{cols:3,rows:2};if(e<=9)return{cols:3,rows:3};if(e<=12)return{cols:4,rows:3};if(e<=16)return{cols:4,rows:4};if(e<=20)return{cols:5,rows:4};if(e<=25)return{cols:5,rows:5};let s=Math.ceil(Math.sqrt(e));return{cols:s,rows:Math.ceil(e/s)}}(h,g);return 0===h?(0,r.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),(0,r.jsx)("p",{className:"text-gray-400 text-sm",children:"Waiting for others to join..."})]})}):(0,r.jsxs)("div",{className:"grid gap-2 sm:gap-3 h-full w-full transition-all duration-300",style:{gridTemplateColumns:"repeat(".concat(f,", 1fr)"),gridTemplateRows:"repeat(".concat(b,", 1fr)")},children:[p&&(0,r.jsxs)("div",{className:"relative bg-gradient-to-br from-zinc-900 to-black rounded-lg sm:rounded-xl overflow-hidden border border-zinc-800 sm:border-2 shadow-xl sm:shadow-2xl transition-all duration-300 group",children:[(0,r.jsx)("video",{ref:d,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent pointer-events-none"}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 sm:bottom-3 sm:left-3 bg-black/70 backdrop-blur-md text-white text-[10px] sm:text-xs font-medium px-2 py-1 sm:px-3 sm:py-1.5 rounded sm:rounded-lg border border-white/10 shadow-lg truncate max-w-[calc(100%-4rem)]",children:l||"You"}),(0,r.jsx)("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded-full border border-black sm:border-2 shadow-lg animate-pulse"})]}),Array.from(t.entries()).filter(e=>{let[t,s]=e;return t&&s.stream&&s.stream!==p}).map((e,t)=>{var s;let[n,o]=e;return(0,r.jsxs)("div",{className:"relative bg-gradient-to-br from-zinc-900 to-black rounded-lg sm:rounded-xl overflow-hidden border border-zinc-800 sm:border-2 shadow-xl sm:shadow-2xl transition-all duration-300 group animate-in fade-in slide-in-from-bottom-4",style:{animationDelay:"".concat(50*t,"ms")},children:[(0,r.jsx)("video",{ref:e=>{e&&n&&(c.current.set(n,e),o.stream&&e.srcObject!==o.stream&&(e.srcObject=o.stream))},autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent pointer-events-none"}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 sm:bottom-3 sm:left-3 bg-black/70 backdrop-blur-md text-white text-[10px] sm:text-xs font-medium px-2 py-1 sm:px-3 sm:py-1.5 rounded sm:rounded-lg border border-white/10 shadow-lg truncate max-w-[calc(100%-4rem)]",children:(null===(s=i.get(n))||void 0===s?void 0:s.username)||n.slice(0,8)}),(0,r.jsx)("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded-full border border-black sm:border-2 shadow-lg"})]},n)})]})}let i=(0,s(3020).Ue)(e=>({roomId:null,meetingTitle:null,userName:null,localStream:null,previewStream:null,cameraStream:null,cameraTrack:null,screenStream:null,peers:new Map,participants:new Map,chatMessages:[],mySocketId:null,isHost:!1,meetingEnded:!1,isAudioEnabled:!0,isVideoEnabled:!0,isScreenSharing:!1,mediaError:null,networkStats:{bitrate:0,jitter:0,rtt:0,lastUpdated:null},sidebarTab:"chat",sidebarVisible:!1,setRoomId:t=>e({roomId:t}),setMeetingTitle:t=>e({meetingTitle:t}),setUserName:t=>e({userName:t}),setLocalStream:t=>e({localStream:t}),setPreviewStream:t=>e({previewStream:t}),setCameraStream:t=>e({cameraStream:t}),setCameraTrack:t=>e({cameraTrack:t}),setScreenStream:t=>e({screenStream:t}),setPeers:t=>e({peers:t}),setParticipants:t=>e({participants:t}),addParticipant:function(t,s){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e(e=>{let n=new Map(e.participants);return n.set(t,{id:t,username:s,isHost:r}),{participants:n}})},removeParticipant:t=>e(e=>{let s=new Map(e.participants);return s.delete(t),{participants:s}}),addChatMessage:t=>e(e=>({chatMessages:[...e.chatMessages,t]})),setMySocketId:t=>e({mySocketId:t}),setIsHost:t=>e({isHost:t}),setMeetingEnded:t=>e({meetingEnded:t}),setIsAudioEnabled:t=>e({isAudioEnabled:t}),setIsVideoEnabled:t=>e({isVideoEnabled:t}),setIsScreenSharing:t=>e({isScreenSharing:t}),setMediaError:t=>e({mediaError:t}),setNetworkStats:t=>e(e=>{var s,r,n,o;return{networkStats:{bitrate:null!==(s=t.bitrate)&&void 0!==s?s:e.networkStats.bitrate,jitter:null!==(r=t.jitter)&&void 0!==r?r:e.networkStats.jitter,rtt:null!==(n=t.rtt)&&void 0!==n?n:e.networkStats.rtt,lastUpdated:null!==(o=t.lastUpdated)&&void 0!==o?o:Date.now()}}}),setSidebarTab:t=>e({sidebarTab:t,sidebarVisible:!0}),setSidebarVisible:t=>e({sidebarVisible:t}),clearChat:()=>e({chatMessages:[]})}));var l=s(6503),c=s(91);let d=e=>{let t=e instanceof Error?e.message:"Unable to update media settings";c.A.error(t),console.error(e)},m=()=>{let{localStream:e,isAudioEnabled:t,setIsAudioEnabled:s}=i.getState();if(!e){c.A.error("Audio device not available");return}let r=e.getAudioTracks();if(0===r.length){c.A.error("No microphone detected");return}let n=!t;r.forEach(e=>{e.enabled=n}),s(n),c.A.info(n?"Microphone unmuted":"Microphone muted",2e3)},u=()=>{let{localStream:e,screenStream:t,isVideoEnabled:s,setIsVideoEnabled:r}=i.getState();if(!e){c.A.error("Camera stream unavailable");return}let n=(null!=t?t:e).getVideoTracks();if(0===n.length){c.A.error("No camera detected");return}let o=!s;n.forEach(e=>{e.enabled=o}),r(o),c.A.info(o?"Camera enabled":"Camera disabled",2e3)},g=async()=>{var e;let{localStream:t,cameraStream:s,cameraTrack:r,peers:n,setPreviewStream:o,setScreenStream:a,setIsScreenSharing:l,setIsVideoEnabled:m,setMediaError:u}=i.getState();if(!t||!r){c.A.error("Camera stream not initialized");return}if(!(null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getDisplayMedia)){c.A.error("Screen sharing is not supported in this browser");return}try{let e=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:60,max:60}},audio:!1}),s=e.getVideoTracks()[0];if(!s){c.A.error("Unable to access display or camera stream");return}n.forEach(e=>{try{var n;let o=e.peer;null===(n=o.replaceTrack)||void 0===n||n.call(o,r,s,t)}catch(e){console.error("Failed to replace track for peer",e)}}),t.removeTrack(r),t.addTrack(s),o(new MediaStream([...e.getVideoTracks(),...t.getAudioTracks()])),a(e),l(!0),m(!0),u(null),s.onended=()=>{x()},c.A.info("Screen sharing started")}catch(e){u(e instanceof Error?e.message:"Failed to start screen share"),d(e)}},x=()=>{let{localStream:e,cameraStream:t,cameraTrack:s,screenStream:r,peers:n,setPreviewStream:o,setScreenStream:a,setIsScreenSharing:l}=i.getState();if(!e||!t||!r||!s)return;let d=r.getVideoTracks()[0];d&&(n.forEach(t=>{try{var r;let n=t.peer;null===(r=n.replaceTrack)||void 0===r||r.call(n,d,s,e)}catch(e){console.error("Failed to restore camera track for peer",e)}}),e.removeTrack(d),e.addTrack(s),r.getTracks().forEach(e=>e.stop()),o(t),a(null),l(!1),c.A.info("Screen sharing stopped"))},p=async()=>{let{isScreenSharing:e}=i.getState();e?x():await g()},h=(0,n.memo)(function(e){let{onLeave:t}=e,{isAudioEnabled:s,isVideoEnabled:n,isScreenSharing:o,networkStats:a,setSidebarTab:c,setSidebarVisible:d,sidebarVisible:g}=i(),x=e=>{c(e),d(!g)};return(0,r.jsx)("div",{className:"pointer-events-none fixed bottom-4 inset-x-0 flex justify-center px-4 z-40",children:(0,r.jsxs)("div",{className:"pointer-events-auto flex items-center gap-3.5 rounded-2xl border border-white/10 bg-gradient-to-b from-black/80 to-black/90 px-4 py-2.5 shadow-2xl shadow-black/40 backdrop-blur-xl max-w-fit justify-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[[{id:"mic",active:s,label:s?"Mute microphone":"Unmute microphone",icon:s?"mic":"mic-off",onClick:m},{id:"video",active:n,label:n?"Disable camera":"Enable camera",icon:n?"video":"video-off",onClick:u},{id:"screen",active:o,label:o?"Stop screen share":"Start screen share",icon:o?"monitor-stop":"monitor",onClick:p}].map(e=>(0,r.jsxs)("button",{onClick:e.onClick,className:"h-10 w-10 rounded-xl flex items-center justify-center transition-all duration-200 ".concat(e.active?"bg-white/15 border border-white/20 text-white shadow-lg shadow-white/5":"bg-white/5 border border-white/10 text-gray-400 hover:text-white hover:bg-white/10 hover:border-white/20"),"aria-pressed":e.active,"aria-label":e.label,title:e.label,children:[(0,r.jsx)(l.Z,{name:e.icon,size:17}),(0,r.jsx)("span",{className:"sr-only",children:e.label})]},e.id)),(0,r.jsxs)("button",{onClick:t,className:"h-10 w-10 rounded-xl bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white flex items-center justify-center shadow-lg shadow-red-500/25 transition-all duration-200 hover:shadow-red-500/40 ml-1","aria-label":"Leave meeting",title:"Leave meeting",children:[(0,r.jsx)(l.Z,{name:"power",size:17}),(0,r.jsx)("span",{className:"sr-only",children:"Leave meeting"})]})]}),(0,r.jsx)("div",{className:"h-8 w-px bg-white/10","aria-hidden":"true"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:[{id:"chat",icon:"chat",label:"Open chat",tab:"chat"},{id:"participants",icon:"users",label:"Participant list",tab:"participants"},{id:"details",icon:"settings",label:"Meeting settings",tab:"details"}].map(e=>(0,r.jsxs)("button",{onClick:()=>x(e.tab),className:"h-10 w-10 rounded-xl bg-white/5 border border-white/10 text-gray-400 hover:text-white hover:bg-white/10 hover:border-white/20 flex items-center justify-center transition-all duration-200","aria-label":e.label,title:e.label,children:[(0,r.jsx)(l.Z,{name:e.icon,size:16}),(0,r.jsx)("span",{className:"sr-only",children:e.label})]},e.id))}),(0,r.jsxs)("div",{className:"hidden lg:flex items-center gap-3 pl-3 ml-2 border-l border-white/10",children:[(0,r.jsxs)("div",{className:"text-center min-w-[60px]",children:[(0,r.jsx)("p",{className:"text-[9px] font-medium uppercase tracking-wider text-gray-500 mb-0.5",children:"Bitrate"}),(0,r.jsxs)("p",{className:"text-xs font-semibold text-gray-200",children:[a.bitrate?"".concat(a.bitrate):"—",a.bitrate&&(0,r.jsx)("span",{className:"text-[10px] text-gray-400 ml-0.5",children:"kbps"})]})]}),(0,r.jsxs)("div",{className:"text-center min-w-[50px]",children:[(0,r.jsx)("p",{className:"text-[9px] font-medium uppercase tracking-wider text-gray-500 mb-0.5",children:"RTT"}),(0,r.jsxs)("p",{className:"text-xs font-semibold text-gray-200",children:[a.rtt?"".concat(a.rtt):"—",a.rtt&&(0,r.jsx)("span",{className:"text-[10px] text-gray-400 ml-0.5",children:"ms"})]})]}),(0,r.jsxs)("div",{className:"text-center min-w-[50px]",children:[(0,r.jsx)("p",{className:"text-[9px] font-medium uppercase tracking-wider text-gray-500 mb-0.5",children:"Jitter"}),(0,r.jsxs)("p",{className:"text-xs font-semibold text-gray-200",children:[a.jitter?"".concat((1e3*a.jitter).toFixed(1)):"—",a.jitter&&(0,r.jsx)("span",{className:"text-[10px] text-gray-400 ml-0.5",children:"ms"})]})]})]})]})})});var f=s(8379);function b(){let{chatMessages:e,mySocketId:t,addChatMessage:s}=i(),[o,a]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1),m=(0,n.useRef)(null),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=(0,f.getSocket)();return d(e.connected),e.on("connect",()=>{d(!0)}),e.on("disconnect",()=>{d(!1)}),e.on("chat-message",e=>{s(e)}),()=>{e.off("chat-message"),e.off("connect"),e.off("disconnect")}},[s]),(0,n.useEffect)(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[e]);let g=()=>{if(o.trim()&&c){var e;(0,f.getSocket)().emit("chat-message",{message:o.trim()}),a(""),null===(e=u.current)||void 0===e||e.focus()}};return(0,r.jsxs)("div",{className:"h-full flex flex-col",children:[(0,r.jsx)("div",{className:"p-4 border-b border-zinc-800",children:(0,r.jsxs)("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,r.jsx)(l.Z,{name:"chat",size:20,className:"text-blue-400"}),"Chat",!c&&(0,r.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(Disconnected)"})]})}),(0,r.jsx)("div",{ref:m,className:"flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin scrollbar-thumb-zinc-700 scrollbar-track-zinc-800",children:0===e.length?(0,r.jsx)("p",{className:"text-gray-500 text-sm text-center py-8",children:"No messages yet. Start the conversation!"}):e.map(e=>{let s=e.userId===t;return(0,r.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[75%] rounded-lg p-3 ".concat(s?"bg-blue-600 text-white":"bg-zinc-800 text-white border border-zinc-700"),children:[!s&&(0,r.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:e.username}),(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:e.message}),(0,r.jsx)("p",{className:"text-xs opacity-70 mt-1",children:new Date(e.timestamp).toLocaleTimeString()})]})},e.id)})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-800",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{ref:u,type:"text",value:o,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())},placeholder:c?"Type a message...":"Connecting...",disabled:!c,className:"flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50"}),(0,r.jsx)("button",{onClick:g,disabled:!c||!o.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"Send"})]})})]})}function w(){let{peers:e,mySocketId:t,isAudioEnabled:s,isVideoEnabled:o,networkStats:a}=i(),[c,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let e=(0,f.getSocket)();d(e.connected),u(e.id||null);let t=()=>{d(!0),u(e.id||null)},s=()=>{d(!1),u(null)};return e.on("connect",t),e.on("disconnect",s),()=>{e.off("connect",t),e.off("disconnect",s)}},[]),(0,r.jsxs)("div",{className:"bg-zinc-900 rounded-xl border border-zinc-800 p-4",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[(0,r.jsx)(l.Z,{name:"network",size:18,className:"text-blue-400"}),"Connection Status"]}),(0,r.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Socket:"}),(0,r.jsx)("span",{className:"flex items-center gap-1 ".concat(c?"text-green-400":"text-red-400"),children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{name:"check",size:14,className:"text-green-400"}),"Connected"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"w-2 h-2 rounded-full bg-red-400"}),"Disconnected"]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Socket ID:"}),(0,r.jsx)("span",{className:"text-gray-300 font-mono text-[10px]",children:m?m.slice(0,8):"N/A"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"My ID:"}),(0,r.jsx)("span",{className:"text-gray-300 font-mono text-[10px]",children:t?t.slice(0,8):"N/A"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Peers:"}),(0,r.jsx)("span",{className:"text-gray-300",children:e.size})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-white/5 mt-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Audio"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:s?"Live":"Muted"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Video"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:o?"On":"Off"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Bitrate"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:a.bitrate?"".concat(a.bitrate," kbps"):"—"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"RTT"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:a.rtt?"".concat(a.rtt," ms"):"—"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Jitter"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:a.jitter?"".concat((1e3*a.jitter).toFixed(1)," ms"):"—"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Updated"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-white",children:a.lastUpdated?new Date(a.lastUpdated).toLocaleTimeString():"—"})]})]})]})]})}function v(e){let{compact:t=!1,onClose:s}=e,[o,a]=(0,n.useState)(null),{peers:d,mySocketId:m,roomId:u,meetingTitle:g,userName:x,participants:p,isHost:h,sidebarTab:v,setSidebarTab:j,setSidebarVisible:y}=i(),N=e=>{if(!h||!e||e===m)return;let t=p.get(e),s=(null==t?void 0:t.username)||"Participant";a(e);let r=(0,f.getSocket)();r.emit("remove-participant",e),c.A.info("Removing ".concat(s,"...")),r.once("participant-removed-success",()=>{c.A.success("Removed ".concat(s," from the meeting"))}),setTimeout(()=>a(null),2e3)};return(0,r.jsxs)("div",{className:t?"flex flex-col overflow-hidden w-[340px] max-h-[70vh] rounded-3xl bg-black/95 border border-blue-900/40 shadow-2xl backdrop-blur-lg":"h-full flex flex-col bg-gradient-to-b from-zinc-900/95 to-black/95 backdrop-blur-xl border-l border-zinc-800/50 shadow-2xl overflow-hidden",children:[t&&(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-blue-900/30",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Room"}),(0,r.jsx)("span",{className:"text-xs text-blue-400/80",children:u})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("button",{onClick:()=>{s?s():y(!1)},className:"text-gray-400 hover:text-white p-1","aria-label":"Close sidebar",children:(0,r.jsx)(l.Z,{name:"close",size:16})})})]}),(0,r.jsxs)("div",{className:"flex border-b border-zinc-800/50 bg-zinc-900/50 flex-shrink-0",children:[(0,r.jsx)("div",{className:"flex flex-1",children:[{id:"chat",label:"Chat",icon:"chat"},{id:"participants",label:"Participants",icon:"users"},{id:"details",label:"Details",icon:"network"}].map(e=>(0,r.jsxs)("button",{onClick:()=>j(e.id),className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-3 lg:px-4 py-2 sm:py-2.5 lg:py-3 text-xs sm:text-sm font-medium transition-all duration-200 relative ".concat(v===e.id?"bg-gradient-to-b from-zinc-800/80 to-zinc-900/80 text-white border-b-2 border-blue-500 shadow-lg shadow-blue-500/20":"text-gray-400 hover:text-white hover:bg-zinc-800/30"),children:[(0,r.jsx)(l.Z,{name:e.icon,size:16,className:"sm:w-4 sm:h-4 lg:w-[18px] lg:h-[18px] ".concat(v===e.id?"text-blue-400":"")}),(0,r.jsx)("span",{className:"hidden sm:inline",children:e.label})]},e.id))}),(0,r.jsx)("button",{onClick:()=>y(!1),className:"lg:hidden px-3 text-gray-400 hover:text-white transition-colors","aria-label":"Hide sidebar",children:(0,r.jsx)(l.Z,{name:"close",size:18})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-hidden",children:["chat"===v&&(0,r.jsx)(b,{}),"participants"===v&&(0,r.jsxs)("div",{className:"h-full overflow-y-auto p-4 space-y-3",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-white mb-4 flex items-center gap-2",children:[(0,r.jsx)(l.Z,{name:"users",size:18,className:"text-blue-400"}),"Participants (",d.size+1,")"]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-zinc-800/80 to-zinc-900/80 rounded-xl p-4 border border-zinc-700/50 shadow-lg hover:border-blue-500/50 transition-all duration-200",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-blue-700 flex items-center justify-center text-white text-sm font-bold shadow-lg",children:m?m.slice(0,2).toUpperCase():"ME"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("p",{className:"text-sm font-semibold text-white",children:[x||"You"," ",m&&"(".concat(m.slice(0,8),")")]}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:h?"Host":"Participant"})]}),(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 shadow-lg shadow-green-500/50"})]})}),Array.from(d.entries()).filter(e=>{let[t]=e;return t}).map((e,t)=>{let[s]=e,n=p.get(s),a=(null==n?void 0:n.username)||s.slice(0,8),i=(null==n?void 0:n.username)?n.username.slice(0,2).toUpperCase():s.slice(0,2).toUpperCase(),l=(null==n?void 0:n.isHost)||!1;return(0,r.jsx)("div",{className:"bg-gradient-to-br from-zinc-800/80 to-zinc-900/80 rounded-xl p-4 border border-zinc-700/50 shadow-lg hover:border-green-500/50 transition-all duration-200 animate-in fade-in slide-in-from-right-4",style:{animationDelay:"".concat(50*t,"ms")},children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-green-600 to-green-700 flex items-center justify-center text-white text-sm font-bold shadow-lg",children:i}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-white truncate",children:a}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:l?"Host":"Participant"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 shadow-lg shadow-green-500/50"}),h&&!l&&(0,r.jsx)("button",{onClick:()=>N(s),disabled:o===s,className:"px-3 py-1.5 text-xs font-medium text-red-400 hover:text-red-300 bg-red-500/10 hover:bg-red-500/20 rounded-lg border border-red-500/30 hover:border-red-500/50 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",title:"Remove participant",children:o===s?"Removing...":"Remove"})]})]})},s)})]})]}),"details"===v&&(0,r.jsxs)("div",{className:"h-full overflow-y-auto p-4",children:[(0,r.jsx)(w,{}),(0,r.jsxs)("div",{className:"mt-4 bg-gradient-to-br from-zinc-800/80 to-zinc-900/80 rounded-xl p-4 border border-zinc-700/50 shadow-lg",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[(0,r.jsx)(l.Z,{name:"network",size:16,className:"text-blue-400"}),"Meeting Details"]}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[g&&(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-zinc-700/50",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Title:"}),(0,r.jsx)("span",{className:"text-white font-medium text-xs bg-zinc-900/50 px-2 py-1 rounded truncate max-w-[150px]",title:g,children:g})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-zinc-700/50",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Room ID:"}),(0,r.jsx)("span",{className:"text-white font-mono text-xs bg-zinc-900/50 px-2 py-1 rounded",children:u||"N/A"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-zinc-700/50",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Total Participants:"}),(0,r.jsx)("span",{className:"text-white font-semibold",children:d.size+1})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Your ID:"}),(0,r.jsx)("span",{className:"text-white font-mono text-xs bg-zinc-900/50 px-2 py-1 rounded",children:m?m.slice(0,8):"N/A"})]})]})]})]})]})]})}function j(e){let{message:t="The meeting has ended"}=e,s=(0,o.useRouter)();return(0,r.jsx)("div",{className:"h-screen bg-gradient-to-br from-black via-zinc-950 to-black flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-gradient-to-br from-zinc-900/95 to-black/95 backdrop-blur-xl rounded-2xl border border-zinc-800/50 shadow-2xl p-8 text-center",children:[(0,r.jsx)("div",{className:"mb-6 flex justify-center",children:(0,r.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-red-600 to-red-700 flex items-center justify-center shadow-lg shadow-red-500/20",children:(0,r.jsx)(l.Z,{name:"stop",size:40,className:"text-white"})})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-white mb-3",children:"Meeting Ended"}),(0,r.jsx)("p",{className:"text-gray-400 mb-8",children:t}),(0,r.jsx)("button",{onClick:()=>s.push("/"),className:"w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium rounded-lg transition-all duration-200 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40",children:"Return to Home"})]})})}var y=s(4967),N=s.n(y),k=s(2949);let S=async(e,t,s,r,n)=>{let o=(0,f.getSocket)(),a=new Map,l=null,d=!1,m=new Map,u=()=>new Promise((e,t)=>{if(o.connected&&o.id){let t=o.id;l=t,r(t),e(t);return}let s=!1,n=setTimeout(()=>{s||(s=!0,o.off("connect",a),o.off("connect_error",i),console.log("⏳ Connection taking longer than expected, continuing in background..."),setTimeout(()=>{if(o.connected&&o.id){let t=o.id;l=t,r(t),e(t)}else u().then(e).catch(t)},2e3))},5e3),a=()=>{if(!s&&o.id){s=!0,clearTimeout(n);let t=o.id;l=t,r(t),o.off("connect",a),o.off("connect_error",i),e(t)}},i=()=>{};o.on("connect",a),o.on("connect_error",i)});try{l=await u(),console.log("\uD83D\uDD0C Socket connected, ID:",l)}catch(e){throw console.error("❌ Failed to connect socket:",e),e}let g=e=>{if(!e||d)return;let t=a.get(e);if(t){try{t.peer.destroyed||t.peer.destroy()}catch(e){}a.delete(e),s(new Map(a))}},x=e=>{let t=a.get(e);if(!t||t.isProcessing||0===t.signalQueue.length||d)return;if(t.peer.connected){console.log("ℹ️ Peer ".concat(e," already connected, clearing signal queue")),t.signalQueue=[],a.set(e,{...t}),s(new Map(a));return}t.isProcessing=!0,a.set(e,{...t}),s(new Map(a));let r=t.signalQueue.shift();if(r&&!t.peer.destroyed&&!d)try{t.peer.signal(r),console.log("✅ Processed queued ".concat(r.type," signal for ").concat(e))}catch(t){var n,o;console.error("❌ Error processing queued signal for ".concat(e,":"),t),((null===(n=t.message)||void 0===n?void 0:n.includes("state"))||(null===(o=t.message)||void 0===o?void 0:o.includes("stable")))&&console.log("⏸️ Skipping queued signal due to state error for ".concat(e))}t.isProcessing=!1,a.set(e,{...t}),s(new Map(a)),t.signalQueue.length>0&&!d&&setTimeout(()=>x(e),200)},p=(e,r)=>{if(!l||!e||e===l||d)return null;a.has(e)&&g(e),console.log("\uD83D\uDD17 Creating peer for ".concat(e," as ").concat(r?"INITIATOR":"ANSWERER"));let n=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},...k.env.NEXT_PUBLIC_TURN_SERVER_URL?[{urls:k.env.NEXT_PUBLIC_TURN_SERVER_URL,username:k.env.NEXT_PUBLIC_TURN_USERNAME||"",credential:k.env.NEXT_PUBLIC_TURN_CREDENTIAL||""}]:[]],c=new(N())({initiator:r,trickle:!0,stream:t,config:{iceServers:n,iceCandidatePoolSize:10,iceTransportPolicy:"all"}});c.on("signal",t=>{if(c.destroyed||!o.connected||!l||d){console.warn("⚠️ Cannot send ".concat(t.type," signal to ").concat(e,":"),{peerDestroyed:c.destroyed,socketConnected:o.connected,mySocketId:l,isCleaningUp:d});return}console.log("\uD83D\uDCE4 Sending ".concat(t.type," signal to ").concat(e),"offer"===t.type?"(INITIATOR)":"answer"===t.type?"(ANSWERER)":""),o.emit("signal",{to:e,signal:t,from:l})}),c.on("stream",t=>{if(c.destroyed||!e||d)return;console.log("✅ Received stream from",e,"- Video tracks:",t.getVideoTracks().length,"Audio tracks:",t.getAudioTracks().length);let r=a.get(e);r?(a.set(e,{peer:r.peer,stream:t,isInitiator:r.isInitiator,isProcessing:r.isProcessing,signalQueue:r.signalQueue}),s(new Map(a)),console.log("\uD83D\uDCF9 Stream updated in peers map for",e)):console.warn("⚠️ No peer data found for",e,"when stream received")}),c.on("error",t=>{console.error("❌ Peer error for",e,":",t),!d&&e&&setTimeout(()=>{d||a.has(e)||(console.log("\uD83D\uDD04 Attempting to recreate peer after error:",e),p(e,r))},2e3)}),c.on("close",()=>{console.log("\uD83D\uDD0C Peer closed for",e),g(e)}),c.on("connect",()=>{console.log("✅ Peer connected for",e),c.connected&&console.log("\uD83D\uDD17 Peer connection verified for",e),e&&u(c,e)});let u=(e,t)=>{let s=null==e?void 0:e._pc;if(!s)return;let r=window.setInterval(async()=>{try{let e=await s.getStats(),t=0,r=0,n=0;e.forEach(e=>{"candidate-pair"===e.type&&"succeeded"===e.state&&(t=e.availableOutgoingBitrate||t,n=e.currentRoundTripTime||n),"remote-inbound-rtp"===e.type&&"video"===e.kind&&(r=e.jitter||r)}),i.getState().setNetworkStats({bitrate:Math.round((t||0)/1e3),jitter:Number((r||0).toFixed(3)),rtt:Number((1e3*(n||0)).toFixed(1)),lastUpdated:Date.now()})}catch(e){console.warn("Unable to fetch peer stats",e)}},4e3);m.set(t,r);let n=()=>{clearInterval(r),m.delete(t)};e.on("close",n),e.on("error",n)};return e&&!d&&(a.set(e,{peer:c,stream:t,isInitiator:r,isProcessing:!1,signalQueue:[]}),s(new Map(a))),c};if(o.on("room-metadata",e=>{if(d||!e)return;let t=i.getState();e.title&&!t.meetingTitle&&t.setMeetingTitle(e.title),void 0!==e.isHost&&(t.setIsHost(e.isHost),console.log(e.isHost?"\uD83C\uDFE0 You are the host":"\uD83D\uDC64 You are a participant"))}),o.on("room-users",e=>{if(!d){console.log("\uD83D\uDCCB Room users received:",e.length,"users");{let t=i.getState(),s=new Map(t.participants);e.forEach(e=>{e&&e.id&&e.username&&s.set(e.id,{id:e.id,username:e.username,isHost:e.isHost||!1})}),t.setParticipants(s)}e&&e.length>0&&setTimeout(()=>{d||e.forEach(e=>{e&&e.id&&e.id!==l&&!a.has(e.id)&&(console.log("\uD83D\uDD17 Creating peer as INITIATOR for existing user:",e.id),p(e.id,!0))})},500)}}),o.on("user-joined",e=>{if(d)return;console.log("\uD83D\uDC64 User joined:",e.id,e.username,e.isHost?"(Host)":""),e.username&&c.A.success("".concat(e.username," joined the meeting")),e.id&&e.username&&i.getState().addParticipant(e.id,e.username,e.isHost||!1);let t=null==e?void 0:e.id;t&&t!==l&&!a.has(t)&&(console.log("\uD83D\uDD17 Creating peer as ANSWERER for new user:",t),setTimeout(()=>{d||a.has(t)||p(t,!1)},500))}),o.on("user-left",e=>{if(d)return;console.log("\uD83D\uDC4B User left:",e);let t="Someone";if(e){let s=i.getState(),r=s.participants.get(e);r&&(t=r.username,c.A.info("".concat(t," left the meeting"))),s.removeParticipant(e)}g(e)}),o.on("signal",e=>{let{from:t,signal:r}=e;if(d||!l||!t||t===l||!r||!r.type)return;console.log("\uD83D\uDCE5 Received ".concat(r.type," signal from ").concat(t));let n=a.get(t);if(n){if(n.peer.destroyed)console.log("\uD83D\uDD04 Peer destroyed, recreating for",t),g(t),p(t,"offer"!==r.type)&&setTimeout(()=>{let e=a.get(t);if(e&&!e.peer.destroyed&&!d)try{e.peer.signal(r),console.log("✅ Applied ".concat(r.type," signal to recreated peer:"),t)}catch(s){console.error("❌ Error signaling recreated peer:",s),e&&(e.signalQueue.push(r),x(t))}},300);else{if(n.peer.connected){console.log("ℹ️ Peer ".concat(t," already connected, ignoring ").concat(r.type," signal"));return}if(n.isProcessing){console.log("⏳ Peer ".concat(t," is processing, queuing ").concat(r.type," signal")),n.signalQueue.push(r),a.set(t,{...n}),s(new Map(a));return}try{n.isProcessing=!0,a.set(t,{...n}),s(new Map(a)),n.peer.signal(r),console.log("✅ Applied ".concat(r.type," signal to peer:"),t),n.isProcessing=!1,a.set(t,{...n}),s(new Map(a)),n.signalQueue.length>0&&setTimeout(()=>x(t),200)}catch(e){var o,i,c,m;n.isProcessing=!1,a.set(t,{...n}),s(new Map(a)),console.error("❌ Error signaling peer:",e),(null===(o=e.message)||void 0===o?void 0:o.includes("state"))||(null===(i=e.message)||void 0===i?void 0:i.includes("stable"))||(null===(c=e.message)||void 0===c?void 0:c.includes("destroyed"))||(null===(m=e.message)||void 0===m?void 0:m.includes("InvalidStateError"))?(console.log("⏸️ Peer ".concat(t," in wrong state, queuing ").concat(r.type," signal")),n.signalQueue.push(r),a.set(t,{...n}),s(new Map(a)),setTimeout(()=>x(t),1e3)):(console.log("\uD83D\uDD04 Recreating peer due to error"),g(t),p(t,"offer"!==r.type)&&setTimeout(()=>{let e=a.get(t);if(e&&!e.peer.destroyed&&!d)try{e.isProcessing=!0,a.set(t,{...e}),s(new Map(a)),e.peer.signal(r),e.isProcessing=!1,a.set(t,{...e}),s(new Map(a))}catch(n){e.isProcessing=!1,a.set(t,{...e}),s(new Map(a)),console.error("Error signaling new peer:",n),e.signalQueue.push(r),x(t)}},500))}}}else{let e="offer"!==r.type;console.log("\uD83D\uDCE1 Creating new peer as ".concat(e?"INITIATOR":"ANSWERER"," for ").concat(t)),p(t,e)&&setTimeout(()=>{let e=a.get(t);if(e&&!e.peer.destroyed&&!d)try{e.isProcessing=!0,a.set(t,{...e}),s(new Map(a)),e.peer.signal(r),console.log("✅ Applied ".concat(r.type," signal to new peer:"),t),e.isProcessing=!1,a.set(t,{...e}),s(new Map(a))}catch(n){e.isProcessing=!1,a.set(t,{...e}),s(new Map(a)),console.error("❌ Error signaling new peer:",n),e.signalQueue.push(r),a.set(t,{...e}),s(new Map(a)),setTimeout(()=>x(t),1e3)}},500)}}),o.on("meeting-ended",e=>{d||(console.log("\uD83C\uDFC1 Meeting ended:",e.message),i.getState().setMeetingEnded(!0))}),o.on("participant-removed",e=>{d||(console.log("\uD83D\uDEAB You have been removed from the meeting"),i.getState().setMeetingEnded(!0),c.A.error(e.message||"You have been removed from the meeting by the host"))}),l){console.log("\uD83D\uDEAA Joining room:",e,"with socket ID:",l);let t=n||"User-".concat(l.slice(0,6)),s=sessionStorage.getItem("hasJoinedRoom_".concat(e)),r=sessionStorage.getItem("meetingTitle");s?console.log("ℹ️ Already joined room, skipping join-room emit"):setTimeout(()=>{!d&&o.connected?(r?o.emit("join-room",e,t,r):o.emit("join-room",e,t),sessionStorage.setItem("hasJoinedRoom_".concat(e),"true"),console.log("✅ Join-room emitted for room:",e)):console.warn("⚠️ Socket not connected, cannot join room")},200)}else throw Error("Socket not connected");return()=>{console.log("\uD83E\uDDF9 Cleaning up WebRTC"),d=!0,m.forEach(e=>clearInterval(e)),m.clear(),o.off("room-users"),o.off("user-joined"),o.off("user-left"),o.off("signal"),o.off("room-metadata"),o.off("meeting-ended"),o.off("participant-removed"),a.forEach(e=>{try{e.peer.destroyed||e.peer.destroy(),e.stream&&e.stream.getTracks&&e.stream.getTracks().forEach(e=>e.stop())}catch(e){}}),a.clear(),s(new Map)}};function E(){let e=(0,o.useParams)(),t=(0,o.useRouter)(),d=e.id,{peers:m,localStream:u,previewStream:g,mySocketId:x,meetingTitle:p,userName:f,meetingEnded:b,participants:w,isHost:y,mediaError:N,sidebarVisible:k,setRoomId:E,setMeetingTitle:T,setUserName:D,setLocalStream:C,setPreviewStream:z,setCameraStream:P,setCameraTrack:R,setScreenStream:A,setPeers:M,setMySocketId:I,setIsAudioEnabled:_,setIsVideoEnabled:U,setIsScreenSharing:Z,setMediaError:O}=i(),[L,F]=(0,n.useState)(!1),[V,H]=(0,n.useState)(!1),[B,Q]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=sessionStorage.getItem("userName"),t=sessionStorage.getItem("meetingTitle");e&&D(e),t&&T(t)},[D,T]),(0,n.useEffect)(()=>{if(x&&f){let{addParticipant:e}=i.getState();e(x,f)}},[x,f]),(0,n.useEffect)(()=>{d&&E(d)},[d,E]),(0,n.useEffect)(()=>(p?document.title="".concat(p," - Study Room"):document.title="Study Room - Premium Video Meetings",()=>{document.title="Study Room - Premium Video Meetings"}),[p]),(0,n.useEffect)(()=>{(async()=>{let{getSocket:e}=await Promise.resolve().then(s.bind(s,8379)),r=e(),n=()=>{F(!0),Q(!1)},o=()=>{F(!1)},a=e=>{if(e){let{setMeetingTitle:t,setIsHost:s}=i.getState();e.title&&!p&&t(e.title),void 0!==e.isHost&&s(e.isHost)}},l=e=>{let{setMeetingEnded:t}=i.getState();t(!0),c.A.info(e.message||"The meeting has ended")},d=e=>{c.A.success(e.message||"Meeting ended successfully"),t.push("/")},m=e=>{console.error("Socket error:",e.message),c.A.error(e.message)};return r.on("connect",n),r.on("disconnect",o),r.on("room-metadata",a),r.on("meeting-ended",l),r.on("meeting-ended-success",d),r.on("error",m),r.connected&&(F(!0),Q(!1)),()=>{r.off("connect",n),r.off("disconnect",o),r.off("room-metadata",a),r.off("meeting-ended",l),r.off("meeting-ended-success",d),r.off("error",m)}})()},[p,T]);let W=async()=>{if(!y){c.A.error("Only the host can end the meeting");return}if(window.confirm("Are you sure you want to end the meeting for all participants?"))try{let{getSocket:e}=await Promise.resolve().then(s.bind(s,8379));e().emit("end-meeting"),c.A.info("Ending meeting...")}catch(e){console.error("Error ending meeting:",e),c.A.error("Failed to end meeting")}};return((0,n.useEffect)(()=>{let e;if(!d)return;let t=null,r=!0;return(async()=>{try{Q(!0);let{getSocket:n}=await Promise.resolve().then(s.bind(s,8379)),o=n();if(!o.connected){console.log("⏳ Waiting for socket connection...");let e=!1;await new Promise(t=>{if(o.connected){t();return}let s=setTimeout(()=>{e||(e=!0,o.off("connect",r),o.off("connect_error",n),console.log("⏳ Connection in progress, continuing setup..."),t())},8e3),r=()=>{e||(e=!0,clearTimeout(s),o.off("connect",r),o.off("connect_error",n),t())},n=()=>{};o.on("connect",r),o.on("connect_error",n)})}if(!r)return;if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("WebRTC is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");let a=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?{width:{ideal:1280,min:640,max:1920},height:{ideal:720,min:480,max:1080},facingMode:"user",frameRate:{ideal:30,max:30}}:{width:{ideal:1920,min:1280,max:1920},height:{ideal:1080,min:720,max:1080},facingMode:"user",frameRate:{ideal:30,max:60}},i={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:{ideal:48e3,min:44100},channelCount:{ideal:2,min:1}};if((t=await navigator.mediaDevices.getUserMedia({video:a,audio:i})).getVideoTracks().forEach(e=>{e.getSettings(),e.applyConstraints({width:a.width,height:a.height,frameRate:a.frameRate}).catch(e=>{console.warn("Could not apply video constraints:",e)})}),t.getAudioTracks().forEach(e=>{e.applyConstraints(i).catch(e=>{console.warn("Could not apply audio constraints:",e)})}),!r){t.getTracks().forEach(e=>e.stop());return}let l=t.getVideoTracks()[0]||null;C(t),z(t),P(t.clone()),R(l),A(null),_(!0),U(!0),Z(!1),console.log("\uD83C\uDFA5 Media stream obtained, initializing WebRTC...");let c=f||sessionStorage.getItem("userName")||"User-".concat(Date.now()),m=p||sessionStorage.getItem("meetingTitle")||null;m&&sessionStorage.setItem("meetingTitle",m),sessionStorage.setItem("userName",c),e=await S(d,t,M,I,c),r&&(F(!0),Q(!1),O(null),console.log("✅ WebRTC initialized"))}catch(e){if(console.error("❌ Error setting up media/WebRTC:",e),r){var n,o;Q(!1),"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?c.A.error("Please allow camera and microphone access to join the room"):(null===(n=e.message)||void 0===n?void 0:n.includes("Socket"))||(null===(o=e.message)||void 0===o?void 0:o.includes("connection"))?(c.A.error("Failed to connect to server. Please ensure the backend server is running on port 3001."),console.error("Socket connection error details:",e)):c.A.error("Error: ".concat(e.message||"Failed to setup media"))}}})(),()=>{console.log("\uD83E\uDDF9 Cleaning up room page"),r=!1,e&&e(),t&&t.getTracks().forEach(e=>e.stop()),C(null),z(null),P(null),R(null),A(null),Z(!1),M(new Map),sessionStorage.removeItem("hasJoinedRoom_".concat(d))}},[d,f]),b)?(0,r.jsx)(j,{message:"The host has left the meeting"}):(0,r.jsxs)("div",{className:"h-screen bg-gradient-to-br from-black via-zinc-950 to-black flex flex-col overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gradient-to-b from-zinc-900/95 to-zinc-900/85 backdrop-blur-xl border-b border-zinc-800/50 px-3 sm:px-5 lg:px-6 py-2.5 sm:py-3 flex-shrink-0 shadow-xl shadow-black/20",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-2.5 lg:gap-3 flex-1 min-w-0 w-full sm:w-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30",children:(0,r.jsx)(l.Z,{name:"video",size:14,className:"text-white sm:w-4 sm:h-4"})}),(0,r.jsx)("h1",{className:"text-sm sm:text-base lg:text-lg font-bold bg-gradient-to-r from-white via-gray-100 to-gray-300 bg-clip-text text-transparent whitespace-nowrap",children:"Study Room"})]}),p&&(0,r.jsx)("div",{className:"px-2 sm:px-2.5 py-1 sm:py-1.5 bg-zinc-800/60 rounded-lg border border-zinc-700/50 max-w-[100px] sm:max-w-[140px] lg:max-w-xs",children:(0,r.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-300 font-medium truncate",title:p,children:p})}),(0,r.jsxs)("div",{className:"hidden sm:flex items-center gap-1.5 px-2.5 py-1.5 bg-zinc-800/60 rounded-lg border border-zinc-700/50",children:[(0,r.jsx)("div",{className:"w-1.5 h-1.5 rounded-full transition-all duration-300 ".concat(L?"bg-green-500 shadow-lg shadow-green-500/50 animate-pulse":"bg-red-500 shadow-lg shadow-red-500/50")}),(0,r.jsx)("span",{className:"text-[10px] sm:text-xs text-gray-300 font-medium whitespace-nowrap",children:L?"Connected":"Connecting..."})]}),(0,r.jsxs)("div",{className:"hidden lg:flex items-center gap-1.5 px-2.5 py-1.5 bg-zinc-800/60 rounded-lg border border-zinc-700/50",children:[(0,r.jsx)(l.Z,{name:"hash",size:12,className:"text-gray-500"}),(0,r.jsx)("p",{className:"text-[10px] text-gray-400 font-mono truncate max-w-[100px]",title:d,children:d})]}),(0,r.jsx)("button",{onClick:()=>{let e="".concat(window.location.origin,"?token=").concat(d);navigator.clipboard.writeText(e),H(!0),c.A.success("Meeting link copied!"),setTimeout(()=>H(!1),2e3)},className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-zinc-800/60 hover:bg-zinc-700/60 border border-zinc-700/50 hover:border-blue-500/40 rounded-lg transition-all duration-200 group",title:"Copy meeting link",children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{name:"check",size:12,className:"text-green-400"}),(0,r.jsx)("span",{className:"hidden sm:inline text-[10px] sm:text-xs text-green-400 font-medium",children:"Copied"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{name:"copy",size:12,className:"text-gray-400 group-hover:text-blue-400 transition-colors"}),(0,r.jsx)("span",{className:"hidden sm:inline text-[10px] sm:text-xs text-gray-400 group-hover:text-blue-400 font-medium transition-colors",children:"Share"})]})})]}),(0,r.jsx)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:y&&(0,r.jsxs)("button",{onClick:W,className:"flex-1 sm:flex-none px-3 sm:px-4 py-1.5 sm:py-2 text-[10px] sm:text-xs font-semibold text-white bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 rounded-lg transition-all duration-200 shadow-lg shadow-orange-500/20 hover:shadow-orange-500/30 whitespace-nowrap flex items-center justify-center gap-1.5",title:"End meeting for all participants",children:[(0,r.jsx)(l.Z,{name:"power",size:12,className:"sm:w-3.5 sm:h-3.5"}),(0,r.jsx)("span",{children:"End Meeting"})]})})]})}),N&&(0,r.jsxs)("div",{className:"bg-red-500/10 border-b border-red-500/30 text-red-200 text-xs sm:text-sm px-4 py-2.5 text-center flex items-center justify-center gap-2",children:[(0,r.jsx)(l.Z,{name:"alert-triangle",size:14}),(0,r.jsx)("span",{children:N})]}),B&&(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full border-2 border-zinc-800/50"}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-16 h-16 rounded-full border-2 border-blue-500 border-t-transparent animate-spin"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{className:"text-gray-300 text-sm font-medium",children:"Setting up your connection"}),(0,r.jsx)("p",{className:"text-gray-500 text-xs",children:"Please wait..."})]})]})}),!B&&(0,r.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden animate-in fade-in duration-500",children:[(0,r.jsx)("div",{className:"w-full bg-gradient-to-br from-zinc-950 to-black p-2 sm:p-3 lg:p-4 overflow-hidden transition-all duration-300 ".concat(k?"lg:w-[80%]":"lg:w-full"),children:(0,r.jsx)(a,{peers:m,localStream:u,previewStream:g,mySocketId:x,participants:w,userName:f})}),(0,r.jsx)("div",{className:"".concat(k?"block":"hidden"," w-full lg:w-[20%] lg:min-w-[300px] max-h-[40vh] lg:max-h-none border-t lg:border-t-0 lg:border-l border-zinc-800/50 bg-zinc-900/50 transition-all duration-300"),children:(0,r.jsx)(v,{})})]}),!B&&(0,r.jsx)(h,{onLeave:()=>{t.push("/")}})]})}},6503:function(e,t,s){"use strict";s.d(t,{Z:function(){return D}});var r=s(7821),n=s(6752),o=s(6810),a=s(7419),i=s(961),l=s(7315),c=s(8149),d=s(7545),m=s(6487),u=s(3671),g=s(9234),x=s(897),p=s(8616),h=s(2212),f=s(2780),b=s(4159),w=s(3467),v=s(4035),j=s(6744),y=s(5095),N=s(5221),k=s(8219),S=s(9775),E=s(3116);let T={video:n.Z,"video-off":o.Z,chat:a.Z,users:i.Z,copy:l.Z,check:c.Z,play:d.Z,stop:m.Z,network:u.Z,brain:g.Z,speaker:x.Z,transcript:p.Z,mic:h.Z,"mic-off":f.Z,monitor:b.Z,"monitor-stop":w.Z,power:v.Z,sparkles:j.Z,shield:y.Z,layers:N.Z,arrow:k.Z,settings:S.Z,close:E.Z};function D(e){let{name:t,className:s="",size:n=20,strokeWidth:o=1.6}=e,a=T[t];return a?(0,r.jsx)(a,{"aria-hidden":"true",className:s,width:n,height:n,strokeWidth:o}):null}},91:function(e,t,s){"use strict";s.d(t,{A:function(){return d},ToastContainer:function(){return m}});var r=s(7821),n=s(8078),o=s(3518),a=s(7610);let i=[],l=[];function c(e){e([...l])}let d={show:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=Math.random().toString(36).substring(7);l=[...l,{id:r,message:e,type:t,duration:s}],i.forEach(c),s>0&&setTimeout(()=>{l=l.filter(e=>e.id!==r),i.forEach(c)},s)},success:(e,t)=>d.show(e,"success",t),error:(e,t)=>d.show(e,"error",t),info:(e,t)=>d.show(e,"info",t)};function m(){let[e,t]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let e=e=>{t(e)};return i.push(e),e(l),()=>{i=i.filter(t=>t!==e)}},[]),(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-2",children:(0,r.jsx)(o.M,{children:e.map(e=>(0,r.jsx)(a.E.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:"px-4 py-3 rounded-lg shadow-lg backdrop-blur-sm border ".concat("success"===e.type?"bg-green-500/10 border-green-500/30 text-green-400":"error"===e.type?"bg-red-500/10 border-red-500/30 text-red-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"),children:(0,r.jsx)("p",{className:"text-sm font-medium",children:e.message})},e.id))})})}},8379:function(e,t,s){"use strict";s.d(t,{getSocket:function(){return l}});var r=s(7093),n=s(2949);let o={SOCKET_PORT:n.env.SOCKET_PORT?parseInt(n.env.SOCKET_PORT):n.env.PORT?parseInt(n.env.PORT)+1:3001,SOCKET_URL:function(){if(n.env.NEXT_PUBLIC_SOCKET_URL)return n.env.NEXT_PUBLIC_SOCKET_URL;{let e="https:"===window.location.protocol?"https:":"http:",t=window.location.hostname,s=n.env.NEXT_PUBLIC_SOCKET_PORT||"3001",r="443"===s&&"https:"===e,o="80"===s&&"http:"===e;return r||o?"".concat(e,"//").concat(t):"".concat(e,"//").concat(t,":").concat(s)}}(),NODE_ENV:"production",NEXT_PUBLIC_APP_URL:n.env.NEXT_PUBLIC_APP_URL?n.env.NEXT_PUBLIC_APP_URL:"".concat(window.location.protocol,"//").concat(window.location.host),ENABLE_LOGGING:"false"!==n.env.ENABLE_LOGGING},a=null,i=0,l=()=>{if(!a){let e=o.SOCKET_URL;console.log("\uD83D\uDD0C Initializing socket connection to:",e),(a=(0,r.io)(e,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:500,reconnectionDelayMax:5e3,reconnectionAttempts:1/0,timeout:1e4,forceNew:!1,upgrade:!0,rememberUpgrade:!0,autoConnect:!0,withCredentials:!1})).on("connect",()=>{i=0,console.log("✅ Socket connected:",null==a?void 0:a.id)}),a.on("disconnect",e=>{"io server disconnect"===e&&(null==a||a.connect()),"transport close"!==e&&"ping timeout"!==e&&console.log("❌ Socket disconnected:",e)}),a.on("connect_error",t=>{var s,r,n;i++;let o={message:null!==(s=null==t?void 0:t.message)&&void 0!==s?s:String(t),type:null!==(r=null==t?void 0:t.type)&&void 0!==r?r:void 0,description:null!==(n=null==t?void 0:t.description)&&void 0!==n?n:void 0,url:e};console.error("⚠️ Socket connection error (attempt ".concat(i,"):"),o),i<=3&&(console.warn("⚠️ Socket connection attempt ".concat(i,":"),o.message),3===i&&console.log("\uD83D\uDCA1 Connection will continue retrying silently..."))}),a.on("reconnect",e=>{i=0,console.log("✅ Socket reconnected after",e,"attempts")}),a.on("reconnect_attempt",()=>{}),a.on("reconnect_error",()=>{})}return a}}},function(e){e.O(0,[610,124,30,115,364,744],function(){return e(e.s=9582)}),_N_E=e.O()}]);